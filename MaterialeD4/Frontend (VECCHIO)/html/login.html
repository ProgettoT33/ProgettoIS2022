<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" type="image/x-icon" href="/html/favicon.ico">
    <title>Stay Busy</title>
</head>
<body>
    <form id="form">
      <input type="checkbox" name="student" id="student" class="scelta" onclick="checkedOnClick(this);">
      <label for="student">Student</label>
      <input type="checkbox" name="offerer" id="offerer" class="scelta" onclick="checkedOnClick(this);">
      <label for="offerer">Offerente</label>
      <br>
      <input type="email" placeholder="Email" name="email" id="email">
      <br>
      <input type="password" placeholder="Password" name="password" id="password">
      <br>
      <button type="submit" id="btn">Login</button>
    </form>
    <br>
    <button type="submit" id="btn2">Registrati</button>
    <script>
      const form = document.getElementById('form');

      function checkedOnClick(el){
        // Select all checkboxes by class
        var checkboxesList = document.getElementsByClassName("scelta");
        for (var i = 0; i < checkboxesList.length; i++) {
          checkboxesList.item(i).checked = false; // Uncheck all checkboxes
        }

        el.checked = true; // Checked clicked checkbox
      }
  
      form.addEventListener('submit', function(e){
        e.preventDefault();
  
        const prePayload = new FormData(form);
        const payload = new URLSearchParams(prePayload);
        console.log([...payload]);
        
        var checkboxesList = document.getElementsByClassName("scelta");
        if(checkboxesList.item(0).checked === false && checkboxesList.item(1).checked === false){
          alert("Attenzione, bisogna scegliere il tipo di utente");
        }else if(checkboxesList.item(0).checked === true){
          alert("ModalitÃ  studente non disponibile");
        }else{
          fetch('../api/offerer/login',{
          method : "POST",
          body : payload
        })
        .then(res => {
          return res.json().then(data => {
              console.log(data);
            if(data.message === 'OK'){
              alert("Benvenuto in Stay Busy!");
              location.replace("../homepage?token="+data.token+"&email="+data.email);
            }else{
              alert("Attenzione, credenziali errate");
            }
          })
        })
        .then(data => console.log(data))
        .catch(err => console.log(err));
        }
      })
      
      btn2.addEventListener('click', function(e){
      e.preventDefault();

      location.replace("../registration")
      })
    </script>
</body>
</html>